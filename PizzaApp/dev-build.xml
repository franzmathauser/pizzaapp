<?xml version="1.0" standalone="yes"?>
<!DOCTYPE project>

<project name="HM.EDU: Generate PizzaApp (Development Build)" default="deploy" basedir=".">

	<!-- set global properties for this build -->
	<property name="config.dir" value="../BuildAndDeployEnvironment" />

	<!-- load global properties (user specific) -->
	<property file="${user.home}/.ant/global-build.properties" />

	<!-- load global properties (workspace specific) -->
	<property file="${config.dir}/pizza_app/global-build.properties" />
	<property file="${config.dir}/global-build.properties" />

	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
			<pathelement location="${libraries.dir}/ant/ant-contrib-1.0b3.jar" />
		</classpath>
	</taskdef>

	<target name="deploy">
		<ant dir="." target="complete-build" />
		<if>
			<equals arg1="${jboss.version}" arg2="7" />
			<then>
				<copy todir="${jboss7.deploy.dir}">
					<fileset dir="${build.env.dist.dir}" includes="PizzaApp.ear" />
				</copy>
			</then>
			<else>
				<copy todir="${jboss6.deploy.dir}">
					<fileset dir="${build.env.dist.dir}" includes="PizzaApp.ear" />
				</copy>
			</else>
		</if>
		<ant dir="." target="final-clean" />
	</target>
	
	<target name="stop-jboss">
		<shellscript shell="bash">
			/opt/bitnami/jboss/bin/shutdown.sh --host=localhost --port=1090 -S
			sleep 20
		</shellscript>
	</target>
	
	<target name="start-jboss">
		<shellscript shell="bash">
			nohup /opt/bitnami/jboss/bin/run.sh >/var/log/jboss.log
		</shellscript>
	</target>

</project>
